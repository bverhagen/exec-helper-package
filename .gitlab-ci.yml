image: dock0/arch

before_script:
    - pacman -Sy --noconfirm
    - pacman -S --noconfirm base-devel

stages:
    - build
    - test
    - verify

PKGBUILD:build:
    stage: build
    script: 
        - cd arch-linux
        - makepkg -s
    artifacts:
        expire_in: 1 day
        paths:
            - "*.tar.xz"

PKGBUILD:test:
    stage: test
    dependencies:
        - PKGBUILD:build
    script:
        - pacman -S --noconfirm --needed namcap
        - namcap PKGBUILD
        - namcap *.tar.xz

PKGBUILD:verify:
    stage: verify
    dependencies:
        - PKGBUILD:build
    script:
        - pacman -U *.tar.gz
        - git submodules update --init
        - exec-helper --settings-file exec-helper/src/plugins/examples/command-line-command.example example
