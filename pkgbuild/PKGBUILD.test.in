# Maintainer: Bart Verhagen <barrie.verhagen@gmail.com>
pkgname=('@PACKAGE@')
pkgbase='exec-helper'
pkgver=@VERSION@
pkgrel=1
epoch=
pkgdesc="Test packages for the associated exec-helper package"
arch=('i686' 'x86_64')
url="https://github.com/bverhagen/exec-helper"
license=('GPL3')
groups=()
depends=(yaml-cpp boost-libs)
makedepends=(cmake boost make doxygen graphviz git pkg-config microsoft-gsl-git catch2)
checkdepends=()
optdepends=()
provides=()
conflicts=()
replaces=()
backup=()
options=()
install=
changelog=@CHANGELOG@
source=('exec-helper::git+https://github.com/bverhagen/exec-helper.git#@GIT_REF@')
noextract=()
validpgpkeys=()

_git_dir='exec-helper'
_build_dir='build'
_exec_helper_test_build_targets=('integration' 'docs-man-integration')

pkgver() {
    printf "%s" $pkgver
}

build() {
    _system_description=$(lsb_release --description --short | sed 's/"//g')
    _source_version=@VERSION@
    _release_version="($_system_description) $_source_version"
    _copyright="Copyright (c) $(date +'%Y') Bart Verhagen"

    cmake -G "Unix Makefiles" -H"$_git_dir" -B"$_build_dir" -DCMAKE_INSTALL_PREFIX="$pkgdir/usr" -DCMAKE_BUILD_TYPE=Release -DUSE_SYSTEM_CATCH=ON -DUSE_SYSTEM_YAML_CPP=ON -DUSE_SYSTEM_GSL=ON -DCMAKE_EXPORT_COMPILE_COMMANDS=OFF -DBUILD_HTML_DOCUMENTATION=OFF -DBUILD_MAN_DOCUMENTATION=ON -DENABLE_TESTING=ON -DENABLE_WERROR=OFF -DVERSION="$_release_version" -DCOPYRIGHT="$_copyright"
    make -C $_build_dir ${_exec_helper_test_build_targets[@]}
}

package_@PACKAGE@() {
    cmake -DCOMPONENT=integration -DCMAKE_INSTALL_PREFIX="$pkgdir/usr" -P "$_build_dir/cmake_install.cmake"
}

md5sums=('SKIP')
